import{d as b,r as d,w as D,g as N,a as R,b as $,u as M,e as V,f as h,c as n,o,n as z,h as S,i as p,j as y,t as f,k as B,l as L,S as j,m as U,p as q,q as x,s as A,F as E,v as G}from"./index-DsgxLMIH.js";const K={class:"text-reader"},W=["disabled"],Y={key:0},Z={key:1},P=b({__name:"ToolBarReadFile",props:{dep:{}},setup(w){const u=w;d(!0);async function v(){a.value=!1,await U(u.dep||"activePlugin"),a.value=!0}const i=d(""),_=d(null),a=d(!0),t=d(!1);D(a,async s=>{if(s===!0)try{const e=await N(u.dep||"activePlugin");t.value=!!e}catch(e){console.error(e)}else t.value=!1},{immediate:!0});function C(s,e=2){if(!+s)return"0 Bytes";const l=1024,g=e<0?0:e,m=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],c=Math.floor(Math.log(s)/Math.log(l));return`${parseFloat((s/Math.pow(l,c)).toFixed(g))} ${m[c]}`}R(async()=>{await $()});const k=M(),r=d(""),F=V();async function H(s){try{r.value="0%",a.value=!1;const e=s.target;if(!e.files)return;const l=e.files;if(!l.length)return;_.value=C(l[0].size),r.value="10%",i.value=l[0].name;const g=await l[0].arrayBuffer();r.value="80%";const m=new Uint8Array(g);r.value="85%";const c=await q(m);if(r.value="90%",u.dep)await x(c,u.dep,!1);else{await x(c,i.value,!0),r.value="98%";const T=await A();k.setPluginHeader(T)}F.triggerReload(),r.value=""}catch(e){console.error(e)}finally{a.value=!0}}return h(()=>k.getPluginHeader?.TMP_dep||""),(s,e)=>(o(),n("div",{class:z(["text-reader__wrapper",{"text-reader__wrapper_dep":s.dep}])},[a.value&&t.value?(o(),n("button",{key:0,class:"text-reader",onClick:v},e[0]||(e[0]=[p("span",null,"Delete",-1)]))):S("",!0),p("label",K,[p("input",{type:"file",accept:".esp,.esm",onChange:H,disabled:!a.value},null,40,W),a.value?(o(),n("span",Y,f(t.value?"Change":"Load"),1)):(o(),n("span",Z,[y(f(r.value),1),B(L(j))]))]),y(" "+f(t.value?"Loaded":"Not loaded"),1)],2))}}),I={class:"frame-upload"},J={class:"frame-upload-deps"},O={key:0,class:"frame-upload-deps__title"},X=b({__name:"ModalContentUpload",setup(w){const u=M(),v=h(()=>u.getPluginHeader),i=h(()=>v.value?.masters?.map(_=>_[0])||[]);return(_,a)=>(o(),n("div",I,[a[0]||(a[0]=p("h2",{class:"modal__title"},"Upload your plugin and its masters",-1)),B(P),p("div",J,[i.value&&i.value.length>0?(o(),n("div",O," Requires: ")):S("",!0),(o(!0),n(E,null,G(i.value,t=>(o(),n("div",{class:"frame-upload-deps__element",key:t},[y(f(t)+" ",1),B(P,{dep:t},null,8,["dep"])]))),128))])]))}});export{X as default};
