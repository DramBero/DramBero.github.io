import{d as S,r as d,w as N,g as R,a as $,b as V,u as C,e as z,f as h,c as n,o as r,n as L,h as _,i as y,j,k as x,S as P,t as f,l as B,m as U,p as q,q as b,s as A,v as E,F as G,x as K}from"./index-DwVzjtnn.js";const W={key:0},Y={class:"text-reader"},Z=["disabled"],I={key:0},J={key:1},M=S({__name:"ToolBarReadFile",props:{dep:{}},setup(w){const i=w;d(!0);async function v(){e.value=!1,await U(i.dep||"activePlugin"),e.value=!0}const u=d(""),c=d(null),e=d(!0),s=d(!1);N(e,async a=>{if(a===!0)try{const t=await R(i.dep||"activePlugin");s.value=!!t}catch(t){console.error(t)}else s.value=!1},{immediate:!0});function F(a,t=2){if(!+a)return"0 Bytes";const l=1024,g=t<0?0:t,m=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],p=Math.floor(Math.log(a)/Math.log(l));return`${parseFloat((a/Math.pow(l,p)).toFixed(g))} ${m[p]}`}$(async()=>{await V()});const k=C(),o=d(""),H=z();async function T(a){try{o.value="0%",e.value=!1;const t=a.target;if(!t.files)return;const l=t.files;if(!l.length)return;c.value=F(l[0].size),o.value="10%",u.value=l[0].name;const g=await l[0].arrayBuffer();o.value="80%";const m=new Uint8Array(g);o.value="85%";const p=await q(m);if(o.value="90%",i.dep)await b(p,i.dep,!1);else{await b(p,u.value,!0),o.value="98%";const D=await A();k.setPluginHeader(D)}H.triggerReload(),o.value=""}catch(t){console.error(t)}finally{e.value=!0}}return h(()=>{var a;return((a=k.getPluginHeader)==null?void 0:a.TMP_dep)||""}),(a,t)=>(r(),n("div",{class:L(["text-reader__wrapper",{"text-reader__wrapper_dep":a.dep}])},[_("button",{class:"text-reader",onClick:v},[e.value?(r(),n("span",W,"Delete")):(r(),j(x(P),{key:1}))]),_("label",Y,[_("input",{type:"file",accept:".esp,.esm",onChange:T,disabled:!e.value},null,40,Z),e.value?(r(),n("span",I,f(s.value?"Change":"Load"),1)):(r(),n("span",J,[y(f(o.value),1),B(x(P))]))]),y(" "+f(s.value?"Loaded":"Not loaded"),1)],2))}}),O={class:"frame-upload"},Q={class:"frame-upload-deps"},X={key:0,class:"frame-upload-deps__title"},ae=S({__name:"ModalContentUpload",setup(w){const i=C(),v=h(()=>i.getPluginHeader),u=h(()=>{var c,e;return((e=(c=v.value)==null?void 0:c.masters)==null?void 0:e.map(s=>s[0]))||[]});return(c,e)=>(r(),n("div",O,[e[0]||(e[0]=_("h2",{class:"modal__title"},"Upload your plugin and its masters",-1)),B(M),_("div",Q,[u.value&&u.value.length>0?(r(),n("div",X," Requires: ")):E("",!0),(r(!0),n(G,null,K(u.value,s=>(r(),n("div",{class:"frame-upload-deps__element",key:s},[y(f(s)+" ",1),B(M,{dep:s},null,8,["dep"])]))),128))])]))}});export{ae as default};
